<!DOCTYPE html>
<html lang="ru" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="–§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç - —É–º–Ω—ã–π AI –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –¥–µ—Ç–µ–π –≤ —É—á—ë–±–µ">
  <meta name="keywords" content="AI —á–∞—Ç, Mistral, –ø–æ–º–æ—â–Ω–∏–∫, –¥–µ—Ç–∏, —É—á—ë–±–∞, —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫">
  <title>üçì –§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç - AI –ü–æ–º–æ—â–Ω–∏–∫</title>

  <!-- PWA Configuration -->
  <meta name="application-name" content="–§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç">
  <meta name="theme-color" content="#ff6b6b">
  <meta name="msapplication-TileColor" content="#ff6b6b">
  <meta name="color-scheme" content="light only">

  <!-- Preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://api.mistral.ai">

  <!-- Modern Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@0.452.0/font/lucide.css">

  <!-- Library Imports -->
  <script src="https://unpkg.com/alpinejs@3.14.0/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.2/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>

  <!-- KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="stylesheet" href="styles/responsive.css">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => console.log('ServiceWorker registered:', registration))
          .catch(error => console.log('ServiceWorker registration failed:', error));
      });
    }
  </script>
</head>

<body x-data="fruitChatApp()" x-init="init()">
  <!-- Fruit Rain Animation -->
  <div class="fruit-rain" id="fruitRain"></div>

  <!-- Sidebar -->
  <div class="sidebar" :class="{ 'active': sidebarOpen }" id="sidebar">
    <div class="sidebar-content glass">
      <div class="sidebar-header">
        <h2 class="sidebar-title">üí¨ –ú–æ–∏ —á–∞—Ç—ã</h2>
        <button @click="closeSidebar()" class="btn-icon">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="mb-6">
        <div class="flex items-center justify-between mb-4">
          <span class="text-gray-700">–í—Å–µ–≥–æ —á–∞—Ç–æ–≤: <span x-text="chats.length" class="font-bold text-primary-gradient"></span></span>
        </div>
      </div>

      <div class="chats-list" id="chatsList">
        <template x-for="chat in sortedChats" :key="chat.id">
          <div class="chat-item"
               :class="{ 'active': chat.id === currentChatId }"
               @click="loadChat(chat.id)">
            <div class="chat-item-header">
              <div class="chat-item-title" x-text="chat.title"></div>
              <div class="chat-item-time" x-text="formatTime(chat.updatedAt)"></div>
            </div>
            <div class="chat-item-preview" x-text="getChatPreview(chat)"></div>
            <div class="chat-item-actions">
              <button @click.stop="deleteChat(chat.id)" class="delete-chat-btn">
                <i class="fas fa-trash text-sm"></i>
              </button>
            </div>
          </div>
        </template>

        <div x-show="chats.length === 0" class="text-center py-8">
          <div class="text-gray-400 mb-2">
            <i class="fas fa-comments text-2xl"></i>
          </div>
          <p class="text-gray-600">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤</p>
        </div>
      </div>

      <button @click="showClearConfirmModal()" class="btn-clear-all w-full mt-4">
        <i class="fas fa-trash-alt"></i>
        <span>–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —á–∞—Ç—ã</span>
      </button>
    </div>
  </div>

  <div class="sidebar-overlay"
       :class="{ 'active': sidebarOpen }"
       @click="closeSidebar()"></div>

  <!-- Main Chat Container -->
  <div class="chat-container glass">
    <!-- Header -->
    <header class="header glass">
      <button @click="openSidebar()" class="btn-icon">
        <i class="fas fa-bars"></i>
      </button>

      <div class="logo">
        <div class="logo-icon"><span>üçì</span></div>
        <div class="logo-text">
          <h1 class="logo-title">–§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç</h1>
          <p class="logo-subtitle">AI –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É—á—ë–±—ã</p>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button @click="toggleEcoMode()" class="btn-icon" :class="{'eco-active': ecoMode}"
                :title="ecoMode ? '–í—ã–∫–ª—é—á–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–µ–∂–∏–º' : '–í–∫–ª—é—á–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–µ–∂–∏–º'">
          <i :class="ecoMode ? 'fas fa-bolt text-yellow-500' : 'fas fa-leaf'"></i>
        </button>

        <button @click="createNewChat()" class="btn-primary">
          <i class="fas fa-plus"></i>
          <span class="hidden md:inline">–ù–æ–≤—ã–π —á–∞—Ç</span>
        </button>
      </div>
    </header>

    <!-- Messages -->
    <main class="messages-container">
      <div id="messagesList"></div>

      <div x-show="currentChat?.messages?.length === 0" class="empty-state">
        <div class="empty-state-icon">üçì</div>
        <h2 class="empty-state-title">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –§—Ä—É–∫—Ç–∏–∫–æ–º!</h2>
        <p class="empty-state-description">
          –ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ—Å–∏—Ç–µ –ø–æ–º–æ—á—å —Å —É—Ä–æ–∫–∞–º–∏ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞–π—Ç–µ—Å—å.
          –§—Ä—É–∫—Ç–∏–∫ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º –≤ —É—á—ë–±–µ!
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-w-md">
          <button @click="setQuickQuestion('–ü–æ–º–æ–≥–∏ —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ')" class="quick-action-btn">
            <i class="fas fa-calculator"></i><span>–ü–æ–º–æ—â—å —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π</span>
          </button>
          <button @click="setRandomTopic()" class="quick-action-btn">
            <i class="fas fa-lightbulb"></i><span>–û–±—ä—è—Å–Ω–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É</span>
          </button>
          <button @click="setQuickQuestion('–ü—Ä–æ–≤–µ—Ä—å –º–æ—ë —Å–æ—á–∏–Ω–µ–Ω–∏–µ –Ω–∞ –æ—à–∏–±–∫–∏')" class="quick-action-btn">
            <i class="fas fa-edit"></i><span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ</span>
          </button>
          <button @click="showRandomFact()" class="quick-action-btn">
            <i class="fas fa-star"></i><span>–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç</span>
          </button>
        </div>
      </div>
    </main>

    <!-- Input Area -->
    <footer class="input-container glass">
      <div class="input-wrapper">
        <div class="input-group">
          <div class="input-field">
            <textarea
              x-model="messageInput"
              @input="updateCharCount()"
              @keydown.enter.prevent="handleEnter($event)"
              :disabled="isSending"
              placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –§—Ä—É–∫—Ç–∏–∫—É..."
              class="textarea"
              id="messageInput"
              rows="1"></textarea>

            <div class="char-counter" :class="charCounterClass" id="charCounter">
              <span x-text="charCount"></span>/1000
            </div>
          </div>

          <button
            @click="sendMessage()"
            :disabled="!messageInput.trim() || isSending"
            class="btn-send"
            id="sendButton">
            <i class="fas" :class="isSending ? 'fa-spinner fa-spin' : 'fa-paper-plane'"></i>
          </button>
        </div>

        <div class="quick-actions">
          <button @click="setQuickQuestion('–ü–æ–º–æ–≥–∏ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É')" class="quick-action-btn">
            <i class="fas fa-lightbulb"></i><span>–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É</span>
          </button>
          <button @click="setRandomTopic()" class="quick-action-btn">
            <i class="fas fa-book-open"></i><span>–û–±—ä—è—Å–Ω–∏—Ç—å —Ç–µ–º—É</span>
          </button>
          <button @click="setQuickQuestion('–ü–æ–¥–≥–æ—Ç–æ–≤—å –º–µ–Ω—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π')" class="quick-action-btn">
            <i class="fas fa-graduation-cap"></i><span>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
          </button>
          <button @click="showRandomFact()" class="quick-action-btn btn-fun-fact">
            <i class="fas fa-star"></i><span>–°–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç</span>
          </button>
        </div>
      </div>
    </footer>
  </div>

  <!-- Welcome Modal (–í–ê–ñ–ù–û: display none –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <div class="modal" id="welcomeModal" style="display:none;">
    <div class="modal-overlay" @click="closeWelcomeModal()"></div>
    <div class="modal-content glass" style="max-width: 500px;">
      <div class="modal-header">
        <h3 class="modal-title">üçì –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –§—Ä—É–∫—Ç–∏–∫ –ß–∞—Ç!</h3>
        <button @click="closeWelcomeModal()" class="btn-icon">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- ... —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ —É —Ç–µ–±—è ... -->
        <div class="text-center mb-6">
          <div class="fruit-icons-grid mb-4">
            <div class="fruit-icon">üçé</div>
            <div class="fruit-icon">üçå</div>
            <div class="fruit-icon">üçá</div>
            <div class="fruit-icon">üçä</div>
            <div class="fruit-icon">üçì</div>
            <div class="fruit-icon">üçâ</div>
          </div>
          <h4 class="text-xl font-bold text-gray-800 mb-2">–í–∞—à AI –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É—á—ë–±—ã</h4>
          <p class="text-gray-600">
            –§—Ä—É–∫—Ç–∏–∫ –ø–æ–º–æ–∂–µ—Ç —Å —É—Ä–æ–∫–∞–º–∏, –æ–±—ä—è—Å–Ω–∏—Ç —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –∏ —Å–¥–µ–ª–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º!
          </p>
        </div>
      </div>
      <div class="modal-actions">
        <button @click="closeWelcomeModal()" class="btn-primary w-full">
          <i class="fas fa-play mr-2"></i> –ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ
        </button>
      </div>
    </div>
  </div>

  <!-- Facts Modal (–í–ê–ñ–ù–û: display none –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <div class="modal" id="factsModal" style="display:none;">
    <div class="modal-overlay" @click="closeFactsModal()"></div>
    <div class="modal-content glass" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">
          <span id="factFruitIcon" style="margin-right: 10px; display: inline-block;">‚ú®</span>
          –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç
        </h3>
        <button @click="closeFactsModal()" class="btn-icon" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="fact-category mb-4" id="factCategory"></div>
        <div class="fact-content">
          <p id="factText" class="fact-text-entrance">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–∫—Ç–∞...</p>
          <div class="fact-number-display">
            <span class="text-gray-600 text-sm">
              –§–∞–∫—Ç <span id="factNumber" class="font-bold text-primary-gradient">1</span> –∏–∑ 100
            </span>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button @click="shareFact()" class="btn-secondary" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–∞–∫—Ç–æ–º">
          <i class="fas fa-share-alt"></i>
          <span class="hidden sm:inline">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
        </button>
        <button @click="showRandomFact()" class="btn-primary" title="–°–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç">
          <i class="fas fa-random"></i>
          <span class="hidden sm:inline">–î—Ä—É–≥–æ–π —Ñ–∞–∫—Ç</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Clear Confirm Modal (–í–ê–ñ–ù–û: display none –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
  <div class="modal" id="clearConfirmModal" style="display:none;">
    <div class="modal-overlay" @click="closeClearConfirmModal()"></div>
    <div class="modal-content glass">
      <div class="modal-header">
        <h3 class="modal-title">‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <button @click="closeClearConfirmModal()" class="btn-icon">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="text-center py-6">
          <div class="text-5xl mb-4 text-red-500">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h4 class="text-xl font-bold text-gray-800 mb-2">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —á–∞—Ç—ã?</h4>
          <p class="text-gray-600">
            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≤–∞—à–∏ —á–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
          </p>
        </div>
      </div>

      <div class="modal-actions">
        <button @click="closeClearConfirmModal()" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        <button @click="confirmClearAllChats()" class="btn-clear-all">
          <i class="fas fa-trash-alt"></i>
          –£–¥–∞–ª–∏—Ç—å –≤—Å—ë
        </button>
      </div>
    </div>
  </div>

  <!-- Status Message -->
  <div class="status-message" id="statusMessage"></div>

  <!-- Eco Mode Indicator -->
  <div class="eco-mode-indicator" id="ecoModeIndicator">
    <i class="fas fa-leaf"></i>
    <span>–≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π —Ä–µ–∂–∏–º</span>
  </div>

  <!-- JavaScript -->
  <script src="js/fruit-icons.js"></script>
  <script src="js/animations.js"></script>
  <script src="js/app.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            { left: '$$', right: '$$', display: true },
            { left: '$', right: '$', display: false },
            { left: '\\(', right: '\\)', display: false },
            { left: '\\[', right: '\\]', display: true }
          ],
          throwOnError: false
        });
      }
    });
  </script>
</body>
</html>
